{% extends "navbar.html" %}
{% block content %}

<div class="col-lg-8 mx-auto p-2">
    <div class="text-center">
        {% for member in member_type %}
        <a href="/account/add-member/{{member.id}}/">
            <button class="btn btn-primary" type="button">{{member.type}} - {% if member.price != 0.00 %} वार्षिक शुल्क : {{member.price}} {% else %} निःशुल्क {% endif %}</button>
        </a>
        {% endfor %}
    </div>


    <h2 class="text-center mt-3">Member Registration</h2>
    <form id="registrationForm">{% csrf_token %}
        <div class="form-group">
            <label for="name">Name</label>
            <input class="form-control" id="name" name="name" placeholder="Enter your name" required type="text">
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input class="form-control" id="email" name="email" placeholder="Enter your email" required type="email">
        </div>
        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input class="form-control" id="phone" name="phone" placeholder="Enter your phone number" required type="text">
        </div>
        <div class="form-group">
            <label for="address">Address</label>
            <textarea class="form-control" id="address" name="address" placeholder="Enter your address"
                      rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label for="pincode">Pincode</label>
            <input class="form-control" id="pincode" name="pincode" placeholder="enter pincode" required type="number">
        </div>
        <div class="form-group">
            <label for="city">City</label>
            <input class="form-control" id="city" name="city" placeholder="enter city" required type="text">
        </div>
        <div class="form-group">
            <label for="district">District</label>
            <input class="form-control" id="district" name="district" placeholder="enter city" required type="text">
        </div>
        <div class="form-group">
            <label for="state">State</label>
            <input class="form-control" id="state" name="state" placeholder="enter state" required type="text" value="">
        </div>
        <div class="form-group">
            <label for="country">country</label>
            <input class="form-control" id="country" name="country" placeholder="enter country" required type="text"
                   value="India">
        </div>
        <div class="form-group">
            <label for="dob">Date of Birth</label>
            <input class="form-control" id="dob" name="dob" placeholder="Enter your date of birth" required type="date">
        </div>
        <div class="form-group">
            <label for="gender">Gender</label>
            <select class="form-control" id="gender" name="gender">
                <option value="">Select your gender</option>
                {% for gender in gender_type %}
                    <option value="{{gender.id}}">{{gender.gender}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group mb-2">
            <label for="id_number">Aadhar Number</label>
            <input class="form-control" id="id_number" name="id_number" placeholder="Enter your id number" required type="text" maxlength="20">
        </div>
        <center><button id="rzp-button1" class="btn btn-primary" type="button">Pay and register</button></center>
        
    </form>

</div>


{% endblock content %}

{% block js %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>-->

  <script>
    var options = {
      "key": "rzp_test_rZ0K5Es4kPAFv2", // Enter the Key ID generated from the Dashboard
      "amount": "{{payment.amount}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Dharm Raksha Sangh",
      "description": "We all are one",
      "image": "https://example.com/your_logo",
      "order_id": "{{payment.id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response) {

        console.log(response);

        var url = '/account/success/';

        var myObject = {
          'razorpay_order_id': response.razorpay_order_id,
          'razorpay_payment_id': response.razorpay_payment_id,
          'razorpay_signature':response.razorpay_signature,
          'price':'{{course.price}}',
          'payment_status':'success',
        }

        $.ajax({
            url: url,
            method: 'POST',
            data: myObject,
            success: function (response) {
                var responseData = response;
                if(responseData.msg == 'success'){
                  window.location.href = '/'
                }
            },
            error: function (xhr, status, error) {
                // Handle error here
                console.log(error);
            }
        });

      },
    };

    var rzp1 = new Razorpay(options);
    rzp1.on('payment.failed', function (response) {
      alert(response.error.code);
      alert(response.error.description);
      alert(response.error.source);
      alert(response.error.step);
      alert(response.error.reason);
      alert(response.error.metadata.order_id);
      alert(response.error.metadata.payment_id);
    });

    document.getElementById('rzp-button1').onclick = function (e) {
      var name = $('#name').val();
      var email = $('#email').val();
      var address = $('#address').val();
      var phone = $('#phone').val();
      var pincode = $('#pincode').val();
      var city = $('#city').val();
      var district = $('#district').val();
      var state = $('#state').val();
      var country = $('#country').val();
      var dob = $('#dob').val();
      var id_number = $('#id_number').val();

      if (name != ''){
        alert('Please enter name')
      }
      else if (email != ''){
        alert('Please enter email')
      }
      else if (address != ''){
        alert('Please enter address')
      }else if (phone != ''){
        alert('Please enter phone')
      }else if (pincode != ''){
        alert('Please enter pincode')
      }else if (city != ''){
        alert('Please enter city')
      }else if (district != ''){
        alert('Please enter district')
      }else if (state != ''){
        alert('Please enter state')
      }else if (country != ''){
        alert('Please enter country')
      }else if (dob != ''){
        alert('Please enter dob')
      }else if (id_number != ''){
        alert('Please enter id_number')
      }
      else{
          rzp1.open();
          e.preventDefault();
      }
    }
  </script>
{% endblock js %}
