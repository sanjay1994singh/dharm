{% extends "navbar.html" %}
{% block content %}

<div class="col-lg-8 mx-auto p-2">
        <div class="row">
            {% for member in member_type %}
                <div class="col-lg-4 m-1 text-center">
                    <a href="/account/add-member/{{member.type}}/">
                        <div>
                            <button class="text-center btn btn-primary" type="button">{{member.type}} - {% if member.price != 0.00 %} वार्षिक शुल्क : {{member.price}} {% else %} निःशुल्क {% endif %}</button>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>


    <h2 class="text-center mt-2">{{mem_name}}</h2>
    <h2 class="text-center mt-3">Member Registration</h2>
    <form id="registrationForm">{% csrf_token %}
        <input type="hidden" name="free_member" value="{{free_member}}">
        <div class="form-group mb-2">
            <label for="name">Name</label>
            <input class="form-control" id="name" name="name" placeholder="Enter Your Name" required type="text">
        </div>

        <div class="form-group mb-2">
            <label for="name">Mobile</label>
            <input class="form-control" id="mobile" name="mobile" placeholder="Enter Your Name" required type="text" maxlength="10">
        </div>
        <div class="form-group mb-2">
            <label for="name">Address</label>
            <input class="form-control" id="address" name="address" placeholder="Enter Your address" required type="text">
        </div>
        <div class="form-group mb-2">
            <label for="name">City</label>
            <input class="form-control" id="city" name="city" placeholder="Enter Your city" required type="text">
        </div>
        <div class="form-group mb-2">
            <label for="name">District</label>
            <input class="form-control" id="district" name="district" placeholder="Enter Your district" required type="text">
        </div>

        <div class="form-group mb-2">
            <label for="name">State</label>
            <input class="form-control" id="state" name="state" placeholder="Enter Your district" required type="text">
        </div>

        <div class="form-group mb-2">
            <label for="name">Country</label>
            <input class="form-control" id="country" name="country" placeholder="Enter Your district" required type="text">
        </div>

        <div class="form-group mb-2">
            <label for="image">Upload Your Photo</label>
            <input class="form-control" id="image" name="image" type="file">
        </div>
        <center><button id="rzp-button1" class="btn btn-primary" type="button">Pay and register</button></center>
        
    </form>

</div>


{% endblock content %}

{% block js %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>
    var options = {
      "key": "rzp_live_0lEv3IcO7TT3bh", // Enter the Key ID generated from the Dashboard
      "amount": "{{payment.amount}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Dharm Raksha Sangh",
      "description": "We all are one",
      "image": "https://example.com/your_logo",
      "order_id": "{{payment.id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response) {

        console.log(response);

        var url = '/account/add-member/'+{{type}}+'/';

        var myObject = {
          'razorpay_order_id': response.razorpay_order_id,
          'razorpay_payment_id': response.razorpay_payment_id,
          'razorpay_signature':response.razorpay_signature,
          'price':'{{payment.amount}}',
          'payment_status':'success',
        }

        $.ajax({
            url: url,
            method: 'POST',
            data: myObject,
            success: function (response) {
                var responseData = response;
                if(responseData.msg == 'success'){
                  window.location.href = '/account/certificate_genrate/'+response.id+'/'
                }
            },
            error: function (xhr, status, error) {
                // Handle error here
                console.log(error);
            }
        });

      },
    };

    var rzp1 = new Razorpay(options);
    rzp1.on('payment.failed', function (response) {
      alert(response.error.code);
      alert(response.error.description);
      alert(response.error.source);
      alert(response.error.step);
      alert(response.error.reason);
      alert(response.error.metadata.order_id);
      alert(response.error.metadata.payment_id);
    });

    document.getElementById('rzp-button1').onclick = function (e) {
        var name = $('#name').val();

        if($('#name').val() == ''){
            alert('Please enter name.')
            return false;
        }
        if($('#mobile').val() == ''){
            alert('Please enter mobile.')
            return false;
        }if($('#city').val() == ''){
            alert('Please enter city.')
            return false;
        }if($('#address').val() == ''){
            alert('Please enter address.')
            return false;
        }if($('#city').val() == ''){
            alert('Please enter city.')
            return false;
        }if($('#district').val() == ''){
            alert('Please enter district.')
            return false;
        }if($('#state').val() == ''){
            alert('Please enter state.')
            return false;
        }if($('#country').val() == ''){
            alert('Please enter country.')
            return false;
        }if($('#image').val() == ''){
            alert('Please upload image.')
            return false;
        }else{
          rzp1.open();
          e.preventDefault();
      }
    }
  </script>
{% endblock js %}
